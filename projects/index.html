<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>プロジェクトギャラリー | Claude Code作品集</title>
    <meta name="description" content="Claude Codeで生成されたプロジェクトの作品集。Webアプリ、ゲーム、ツールなど多数の作品を掲載。">
    <meta name="keywords" content="Claude Code, プロジェクトギャラリー, Webアプリ, ゲーム開発, プログラミング, AI生成">
    <meta name="author" content="Claude Code">
    <meta name="robots" content="index, follow">
    <link rel="canonical" id="canonical-url" href="">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" id="og-url" content="">
    <meta property="og:title" content="プロジェクトギャラリー | Claude Code作品集">
    <meta property="og:description" content="Claude Codeで生成されたプロジェクトの作品集。Webアプリ、ゲーム、ツールなど多数の作品を掲載。">
    <meta property="og:image" id="og-image" content="https://placehold.co/1200x630/667eea/ffffff?text=Claude+Code+Gallery">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="Claude Code プロジェクトギャラリー">
    <meta property="og:locale" content="ja_JP">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" id="twitter-url" content="">
    <meta name="twitter:title" content="プロジェクトギャラリー | Claude Code作品集">
    <meta name="twitter:description" content="Claude Codeで生成されたプロジェクトの作品集。Webアプリ、ゲーム、ツールなど多数の作品を掲載。">
    <meta name="twitter:image" id="twitter-image" content="https://placehold.co/1200x630/667eea/ffffff?text=Claude+Code+Gallery">
    <meta name="twitter:image:alt" content="Claude Code プロジェクトギャラリー">

    <!-- Additional SEO -->
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="プロジェクトギャラリー">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- PapaParse for CSV parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <style>
        /* Tailwind config for custom colors */
        @layer utilities {
            .line-clamp-2 {
                display: -webkit-box;
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
                overflow: hidden;
            }
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#667eea',
                        'primary-hover': '#5568d3',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 text-gray-900">
    <!-- Hero Section -->
    <section class="bg-white text-gray-900 pt-20 pb-16 px-6 text-center border-b border-gray-200">
        <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold mb-4 tracking-tight">プロジェクトギャラリー</h1>
        <p class="text-base md:text-xl max-w-3xl mx-auto mb-8 opacity-95 leading-relaxed">
            Claude Codeで生成された作品の集合です。<br>
            Webアプリケーション、ゲーム、ツールなど、多様なプロジェクトを掲載しています。<br>
            検索やタイムラインから、お探しの作品を見つけてください。
        </p>
        <div class="flex justify-center gap-10 flex-wrap mt-8">
            <div class="text-center">
                <span class="text-4xl font-bold block" id="totalProjects">-</span>
                <span class="text-sm opacity-90 uppercase tracking-wide">プロジェクト</span>
            </div>
            <div class="text-center">
                <span class="text-4xl font-bold block" id="totalTags">-</span>
                <span class="text-sm opacity-90 uppercase tracking-wide">タグ</span>
            </div>
            <div class="text-center">
                <span class="text-4xl font-bold block" id="latestUpdate">-</span>
                <span class="text-sm opacity-90 uppercase tracking-wide">最新更新</span>
            </div>
        </div>
    </section>

    <!-- Search Bar -->
    <div class="max-w-6xl mx-auto -mt-8 mb-10 px-6 relative z-10">
        <div class="bg-white rounded-xl p-4 px-6 shadow-lg flex items-center gap-3">
            <span class="text-gray-500 text-xl">検索:</span>
            <input
                type="text"
                class="flex-1 border-none text-base outline-none text-gray-900 placeholder-gray-500"
                id="searchInput"
                placeholder="プロジェクト名やタグで検索..."
                autocomplete="off"
            >
        </div>
    </div>

    <!-- Main Container -->
    <div class="max-w-7xl mx-auto py-10 px-6 flex gap-8 flex-col md:flex-row">
        <!-- Sidebar -->
        <aside class="w-full md:w-64 flex-shrink-0 md:sticky md:top-6 md:self-start md:max-h-[calc(100vh-3rem)] md:overflow-y-auto">
            <div class="bg-white rounded-xl p-5 mb-4 shadow-sm">
                <div class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-4">期間で表示</div>
                <div id="timelineNav"></div>
            </div>
            <div class="bg-white rounded-xl p-5 mb-4 shadow-sm">
                <div class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-4">チャンネルで絞り込み</div>
                <div id="channelFilter"></div>
            </div>
            <div class="bg-white rounded-xl p-5 mb-4 shadow-sm">
                <div class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-4">作成者で絞り込み</div>
                <div id="authorFilter"></div>
            </div>
        </aside>

        <!-- Gallery -->
        <main class="flex-1 min-w-0" id="gallery">
            <div class="text-center py-16 px-5 text-gray-500">
                <div class="w-12 h-12 border-4 border-gray-200 border-t-primary rounded-full animate-spin mx-auto mb-4"></div>
                <p>プロジェクトを読み込んでいます...</p>
            </div>
        </main>
    </div>

    <!-- Scroll to Top Button -->
    <button class="fixed bottom-8 right-8 w-12 h-12 bg-primary text-white border-none rounded-full text-xl cursor-pointer shadow-lg opacity-0 invisible transition-all duration-300 z-50 hover:bg-primary-hover hover:-translate-y-0.5" id="scrollTopBtn" title="トップへ戻る">
        ↑
    </button>

    <script>
        // Configuration
        const CSV_PATH = 'projects.csv';
        const ITEMS_PER_PAGE = 12;

        // State
        let allProjects = [];
        let filteredProjects = [];
        let displayedCount = 0;
        let isLoading = false;
        let currentFilter = '';
        let isInitialized = false;
        let selectedChannel = '';
        let selectedAuthor = '';

        // Elements
        const gallery = document.getElementById('gallery');
        const searchInput = document.getElementById('searchInput');
        const timelineNav = document.getElementById('timelineNav');
        const channelFilter = document.getElementById('channelFilter');
        const authorFilter = document.getElementById('authorFilter');
        const scrollTopBtn = document.getElementById('scrollTopBtn');

        // Update meta tags for SEO and SNS sharing
        function updateMetaTags() {
            const currentUrl = window.location.href;
            const baseUrl = window.location.origin + window.location.pathname;

            // Update canonical URL
            document.getElementById('canonical-url').setAttribute('href', baseUrl);

            // Update Open Graph URLs
            document.getElementById('og-url').setAttribute('content', baseUrl);
            document.getElementById('twitter-url').setAttribute('content', baseUrl);

            // Use first project's image as OG image, or generate a default
            // This will be updated after CSV is loaded with the latest project's image
        }

        // Load and parse CSV
        async function loadProjects() {
            if (isInitialized || isLoading) {
                return;
            }
            isLoading = true;

            // Update meta tags immediately
            updateMetaTags();

            try {
                const response = await fetch(CSV_PATH);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const csvText = await response.text();

                Papa.parse(csvText, {
                    header: true,
                    skipEmptyLines: true,
                    complete: function(results) {
                        if (results.errors.length > 0) {
                            console.error('CSV parsing errors:', results.errors);
                        }

                        allProjects = results.data
                            .filter(project => project.url && project.title)
                            .map(project => ({
                                ...project,
                                created_at: new Date(project.created_at),
                                tags: project.tags ? project.tags.split(';').map(t => t.trim()) : [],
                                author: project.author || '',
                                channel: project.channel || ''
                            }))
                            .sort((a, b) => b.created_at - a.created_at);

                        filteredProjects = [...allProjects];
                        updateStats();
                        renderTimeline();
                        renderChannelFilter();
                        renderAuthorFilter();
                        renderProjects();
                        setupInfiniteScroll();

                        // Update OG image with the latest project's thumbnail
                        if (allProjects.length > 0 && allProjects[0].image_url) {
                            document.getElementById('og-image').setAttribute('content', allProjects[0].image_url);
                            document.getElementById('twitter-image').setAttribute('content', allProjects[0].image_url);
                        } else {
                            // Fallback to a default placeholder
                            const fallbackImage = 'https://dummyimage.com/1200x630/667eea/ffffff&text=Claude+Code+Gallery';
                            document.getElementById('og-image').setAttribute('content', fallbackImage);
                            document.getElementById('twitter-image').setAttribute('content', fallbackImage);
                        }

                        isInitialized = true;
                        isLoading = false;
                    },
                    error: function(error) {
                        showError('CSVファイルの解析に失敗しました: ' + error.message);
                        isLoading = false;
                    }
                });
            } catch (error) {
                showError('プロジェクトの読み込みに失敗しました: ' + error.message);
                isLoading = false;
            }
        }

        // Update statistics
        function updateStats() {
            document.getElementById('totalProjects').textContent = allProjects.length;

            const uniqueTags = new Set();
            allProjects.forEach(p => p.tags.forEach(t => uniqueTags.add(t)));
            document.getElementById('totalTags').textContent = uniqueTags.size;

            if (allProjects.length > 0) {
                const latest = allProjects[0].created_at;
                const now = new Date();
                const diffDays = Math.floor((now - latest) / (1000 * 60 * 60 * 24));

                if (diffDays === 0) {
                    document.getElementById('latestUpdate').textContent = '今日';
                } else if (diffDays === 1) {
                    document.getElementById('latestUpdate').textContent = '昨日';
                } else if (diffDays < 7) {
                    document.getElementById('latestUpdate').textContent = `${diffDays}日前`;
                } else {
                    document.getElementById('latestUpdate').textContent = latest.toLocaleDateString('ja-JP', { month: 'short', day: 'numeric' });
                }
            }
        }

        // Group projects by period
        function groupByPeriod(projects) {
            const groups = {
                '今日': [],
                '昨日': [],
                '今週': [],
                '今月': [],
                '過去': {}
            };

            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            const weekAgo = new Date(today);
            weekAgo.setDate(weekAgo.getDate() - 7);
            const monthAgo = new Date(today);
            monthAgo.setMonth(monthAgo.getMonth() - 1);

            projects.forEach(project => {
                const date = new Date(project.created_at);
                const dayStart = new Date(date.getFullYear(), date.getMonth(), date.getDate());

                if (dayStart.getTime() === today.getTime()) {
                    groups['今日'].push(project);
                } else if (dayStart.getTime() === yesterday.getTime()) {
                    groups['昨日'].push(project);
                } else if (date >= weekAgo) {
                    groups['今週'].push(project);
                } else if (date >= monthAgo) {
                    groups['今月'].push(project);
                } else {
                    const yearMonth = date.toLocaleDateString('ja-JP', { year: 'numeric', month: 'long' });
                    if (!groups['過去'][yearMonth]) {
                        groups['過去'][yearMonth] = [];
                    }
                    groups['過去'][yearMonth].push(project);
                }
            });

            return groups;
        }

        // Render timeline navigation
        function renderTimeline() {
            const groups = groupByPeriod(filteredProjects);
            let html = '';

            // Recent periods
            ['今日', '昨日', '今週', '今月'].forEach(period => {
                if (groups[period].length > 0) {
                    html += `
                        <div class="timeline-item p-3 mb-1 rounded-lg cursor-pointer transition-all duration-200 flex justify-between items-center hover:bg-gray-50" data-period="${period}">
                            <span class="text-sm">${period}</span>
                            <span class="text-xs text-gray-500 font-semibold">${groups[period].length}</span>
                        </div>
                    `;
                }
            });

            // Past periods
            const pastPeriods = Object.keys(groups['過去']).sort((a, b) => {
                return new Date(b) - new Date(a);
            });

            pastPeriods.forEach(period => {
                html += `
                    <div class="timeline-item p-3 mb-1 rounded-lg cursor-pointer transition-all duration-200 flex justify-between items-center hover:bg-gray-50" data-period="${period}">
                        <span class="text-sm">${period}</span>
                        <span class="text-xs text-gray-500 font-semibold">${groups['過去'][period].length}</span>
                    </div>
                `;
            });

            timelineNav.innerHTML = html;

            // Add click handlers
            document.querySelectorAll('.timeline-item').forEach(item => {
                item.addEventListener('click', () => {
                    document.querySelectorAll('.timeline-item').forEach(i => {
                        i.classList.remove('bg-blue-50', 'text-primary', 'font-medium');
                        i.classList.add('hover:bg-gray-50');
                    });
                    item.classList.remove('hover:bg-gray-50');
                    item.classList.add('bg-blue-50', 'text-primary', 'font-medium');

                    const period = item.dataset.period;
                    scrollToPeriod(period);
                });
            });
        }

        // Render channel filter
        function renderChannelFilter() {
            const channels = new Set();
            allProjects.forEach(p => {
                if (p.channel) channels.add(p.channel);
            });

            const sortedChannels = Array.from(channels).sort();

            let html = `
                <div class="timeline-item p-3 mb-1 rounded-lg cursor-pointer transition-all duration-200 flex justify-between items-center ${selectedChannel === '' ? 'bg-blue-50 text-primary font-medium' : 'hover:bg-gray-50'}" data-channel="">
                    <span class="text-sm">すべて</span>
                    <span class="text-xs text-gray-500 font-semibold">${allProjects.length}</span>
                </div>
            `;

            sortedChannels.forEach(channel => {
                const count = allProjects.filter(p => p.channel === channel).length;
                html += `
                    <div class="timeline-item p-3 mb-1 rounded-lg cursor-pointer transition-all duration-200 flex justify-between items-center ${selectedChannel === channel ? 'bg-blue-50 text-primary font-medium' : 'hover:bg-gray-50'}" data-channel="${channel}">
                        <span class="text-sm">#${channel}</span>
                        <span class="text-xs text-gray-500 font-semibold">${count}</span>
                    </div>
                `;
            });

            channelFilter.innerHTML = html;

            // Add click handlers
            document.querySelectorAll('[data-channel]').forEach(item => {
                item.addEventListener('click', () => {
                    document.querySelectorAll('[data-channel]').forEach(i => {
                        i.classList.remove('bg-blue-50', 'text-primary', 'font-medium');
                        i.classList.add('hover:bg-gray-50');
                    });
                    item.classList.remove('hover:bg-gray-50');
                    item.classList.add('bg-blue-50', 'text-primary', 'font-medium');
                    selectedChannel = item.dataset.channel;
                    applyFilters();
                });
            });
        }

        // Render author filter
        function renderAuthorFilter() {
            const authors = new Set();
            allProjects.forEach(p => {
                if (p.author) authors.add(p.author);
            });

            const sortedAuthors = Array.from(authors).sort();

            let html = `
                <div class="timeline-item p-3 mb-1 rounded-lg cursor-pointer transition-all duration-200 flex justify-between items-center ${selectedAuthor === '' ? 'bg-blue-50 text-primary font-medium' : 'hover:bg-gray-50'}" data-author="">
                    <span class="text-sm">すべて</span>
                    <span class="text-xs text-gray-500 font-semibold">${allProjects.length}</span>
                </div>
            `;

            sortedAuthors.forEach(author => {
                const count = allProjects.filter(p => p.author === author).length;
                html += `
                    <div class="timeline-item p-3 mb-1 rounded-lg cursor-pointer transition-all duration-200 flex justify-between items-center ${selectedAuthor === author ? 'bg-blue-50 text-primary font-medium' : 'hover:bg-gray-50'}" data-author="${author}">
                        <span class="text-sm">👤 ${author}</span>
                        <span class="text-xs text-gray-500 font-semibold">${count}</span>
                    </div>
                `;
            });

            authorFilter.innerHTML = html;

            // Add click handlers
            document.querySelectorAll('[data-author]').forEach(item => {
                item.addEventListener('click', () => {
                    document.querySelectorAll('[data-author]').forEach(i => {
                        i.classList.remove('bg-blue-50', 'text-primary', 'font-medium');
                        i.classList.add('hover:bg-gray-50');
                    });
                    item.classList.remove('hover:bg-gray-50');
                    item.classList.add('bg-blue-50', 'text-primary', 'font-medium');
                    selectedAuthor = item.dataset.author;
                    applyFilters();
                });
            });
        }

        // Apply all active filters
        function applyFilters() {
            const searchQuery = searchInput.value.toLowerCase().trim();

            filteredProjects = allProjects.filter(project => {
                // Search filter
                const matchesSearch = !searchQuery ||
                    project.title.toLowerCase().includes(searchQuery) ||
                    project.tags.some(tag => tag.toLowerCase().includes(searchQuery));

                // Channel filter
                const matchesChannel = !selectedChannel || project.channel === selectedChannel;

                // Author filter
                const matchesAuthor = !selectedAuthor || project.author === selectedAuthor;

                return matchesSearch && matchesChannel && matchesAuthor;
            });

            renderTimeline();
            renderProjects();
        }

        // Scroll to specific period
        function scrollToPeriod(period) {
            const section = document.querySelector(`[data-section="${period}"]`);
            if (section) {
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        // Render projects
        function renderProjects(append = false) {
            if (!append) {
                gallery.innerHTML = '';
                displayedCount = 0;
            }

            if (filteredProjects.length === 0) {
                gallery.innerHTML = `
                    <div class="text-center py-20 px-5 text-gray-500">
                        <div class="text-xl font-semibold text-gray-900 mb-2">プロジェクトが見つかりません</div>
                        <div class="text-base">検索条件を変更してお試しください</div>
                    </div>
                `;
                return;
            }

            const groups = groupByPeriod(filteredProjects);
            const periods = ['今日', '昨日', '今週', '今月'];

            periods.forEach(period => {
                if (groups[period].length > 0) {
                    renderSection(period, groups[period]);
                }
            });

            // Render past periods
            const pastPeriods = Object.keys(groups['過去']).sort((a, b) => {
                return new Date(b) - new Date(a);
            });

            pastPeriods.forEach(period => {
                renderSection(period, groups['過去'][period]);
            });
        }

        // Render a section
        function renderSection(title, projects) {
            const section = document.createElement('div');
            section.className = 'mb-12';
            section.dataset.section = title;

            section.innerHTML = `
                <div class="mb-6 pb-4 border-b-2 border-gray-200">
                    <h2 class="text-2xl font-semibold text-gray-900 mb-1">${title}</h2>
                    <div class="text-sm text-gray-500">${projects.length} プロジェクト</div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    ${projects.map(project => createProjectCard(project)).join('')}
                </div>
            `;

            gallery.appendChild(section);
        }

        // Create project card HTML
        function createProjectCard(project) {
            const dateStr = project.created_at.toLocaleDateString('ja-JP', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });

            // Tag colors mapping
            const tagColors = {
                'html': 'bg-red-50 text-red-600',
                'css': 'bg-blue-50 text-blue-600',
                'javascript': 'bg-yellow-50 text-yellow-700',
                'python': 'bg-cyan-50 text-cyan-700',
                'react': 'bg-sky-50 text-sky-500',
                'game': 'bg-purple-50 text-purple-600'
            };

            const tagsHTML = project.tags.map(tag => {
                const colorClass = tagColors[tag.toLowerCase()] || 'bg-gray-100 text-gray-600';
                return `<span class="px-2.5 py-1 rounded-md text-xs font-medium uppercase tracking-wide ${colorClass}">${tag}</span>`;
            }).join('');

            const authorHTML = project.author ? `<span class="text-xs text-primary bg-blue-50 px-2 py-1 rounded font-medium">👤 ${project.author}</span>` : '';
            const channelHTML = project.channel ? `<span class="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded">#${project.channel}</span>` : '';

            return `
                <a href="${project.url}" class="block bg-white rounded-xl overflow-hidden shadow-sm hover:shadow-md hover:-translate-y-1 transition-all duration-300 cursor-pointer no-underline" target="_blank" rel="noopener noreferrer">
                    <img src="${project.image_url}" alt="${project.title}" class="w-full h-52 object-cover bg-gray-100" loading="lazy" onerror="this.onerror=null; this.src='https://dummyimage.com/400x300/f5f5f7/999999&text=No+Image';">
                    <div class="p-5">
                        <h3 class="text-lg font-semibold mb-2 text-gray-900 line-clamp-2">${project.title}</h3>
                        <div class="flex items-center gap-2 mt-3 flex-wrap">
                            <span class="text-xs text-gray-500">${dateStr}</span>
                            ${authorHTML}
                            ${channelHTML}
                            ${tagsHTML ? `<div class="flex gap-1.5 flex-wrap">${tagsHTML}</div>` : ''}
                        </div>
                    </div>
                </a>
            `;
        }

        // Search functionality
        searchInput.addEventListener('input', (e) => {
            applyFilters();
        });

        // Setup infinite scroll (for future expansion)
        function setupInfiniteScroll() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting && !isLoading) {
                        // Future: Load more items
                    }
                });
            }, {
                rootMargin: '100px'
            });

            // Observe a sentinel element if needed
        }

        // Scroll to top button
        window.addEventListener('scroll', () => {
            if (window.pageYOffset > 300) {
                scrollTopBtn.classList.remove('opacity-0', 'invisible');
                scrollTopBtn.classList.add('opacity-100', 'visible');
            } else {
                scrollTopBtn.classList.remove('opacity-100', 'visible');
                scrollTopBtn.classList.add('opacity-0', 'invisible');
            }
        });

        scrollTopBtn.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Error handling
        function showError(message) {
            gallery.innerHTML = `
                <div class="bg-orange-50 border-2 border-orange-400 rounded-xl p-6 my-10 mx-auto max-w-2xl text-center">
                    <div class="text-lg font-semibold text-orange-700 mb-2">エラーが発生しました</div>
                    <div class="text-sm text-gray-700 mb-3">${message}</div>
                    <div class="text-sm text-gray-700 mt-3 text-left">
                        <strong>確認事項:</strong><br>
                        • projects.csv ファイルが存在するか<br>
                        • CSVファイルの形式が正しいか（url, title, image_url, created_at, tags）<br>
                        • Webサーバーで実行しているか（file://では動作しません）
                    </div>
                </div>
            `;
        }

        // Initialize - Run only once when the page loads
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadProjects);
        } else {
            // DOM already loaded
            loadProjects();
        }
    </script>
</body>
</html>
